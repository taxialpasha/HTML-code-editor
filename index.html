<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØµÙØ­ Ø§Ù„Ù…Ù„ÙØ§Øª</title>
    <style>
        /* CSS Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            background-color: #f5f5f5;
            overflow: hidden;
        }

        .sidebar {
            width: 0;
            height: 100%;
            background-color: #2c3e50;
            transition: width 0.3s ease;
            overflow-y: auto;
            overflow-x: hidden;
            color: white;
        }

        .sidebar-expanded {
            width: 250px;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: white;
            transition: margin-right 0.3s ease;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: #3498db;
            color: white;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .folder-list {
            padding: 10px;
        }

        .folder-item, .file-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .folder-item {
            background-color: #34495e;
        }

        .folder-item:hover, .file-item:hover {
            opacity: 0.8;
        }

        .file-item {
            background-color: #7f8c8d;
        }

        .folder-item i, .file-item i {
            margin-left: 10px;
        }

        .file-content {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            min-height: 300px;
            white-space: pre-wrap;
            font-family: monospace;
            margin-top: 20px;
        }

        .file-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 10px;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background-color: #2980b9;
        }

        .btn-open {
            background-color: #2ecc71;
        }

        .btn-open:hover {
            background-color: #27ae60;
        }

        .btn-run {
            background-color: #e74c3c;
        }

        .btn-run:hover {
            background-color: #c0392b;
        }

        .icon {
            margin-left: 8px;
            font-size: 1.2em;
        }

        .preview-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 20px;
            padding: 20px;
            background-color: white;
            min-height: 300px;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 70vh;
            text-align: center;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 5em;
            margin-bottom: 20px;
        }

        /* Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆÙ…Ø¤Ø«Ø±Ø§Øª Ø¨ØµØ±ÙŠØ© */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 0;
                transition: height 0.3s ease;
            }
            
            .sidebar-expanded {
                width: 100%;
                height: 250px;
            }
            
            .main-content {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="folder-list" id="folder-list">
            <!-- Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ù„ÙØ§Øª -->
        </div>
    </div>
    
    <div class="main-content" id="main-content">
        <div class="header">
            <h2>Ù…ØªØµÙØ­ Ø§Ù„Ù…Ù„ÙØ§Øª</h2>
            <button id="toggle-sidebar">â˜° Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        </div>
        
        <div class="empty-state" id="empty-state">
            <i>ğŸ“</i>
            <h3>Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ø£Ùˆ Ù…Ø¬Ù„Ø¯Ù‹Ø§ Ù„Ù„Ø¨Ø¯Ø¡</h3>
            <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£Ùˆ Ù…Ø¬Ù„Ø¯ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ</p>
            <button id="open-folder" class="btn-open pulse">ÙØªØ­ Ù…Ø¬Ù„Ø¯</button>
        </div>
        
        <div id="file-explorer" style="display: none;">
            <div class="file-actions">
                <button id="back-button">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ù„Ù</button>
                <button id="new-folder-btn" class="btn-open">Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯</button>
            </div>
            
            <div id="current-path" style="margin: 15px 0; font-weight: bold; color: #3498db;"></div>
            
            <div id="file-listing"></div>
            
            <div id="file-viewer" style="display: none;">
                <h3 id="current-file-name"></h3>
                <div class="file-actions">
                    <button id="run-btn" class="btn-run">ØªØ´ØºÙŠÙ„</button>
                    <button id="save-btn">Ø­ÙØ¸</button>
                </div>
                <textarea id="file-content" class="file-content"></textarea>
                <div id="preview-container" class="preview-container" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // JavaScript Code
        document.addEventListener('DOMContentLoaded', function() {
            // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const toggleSidebarBtn = document.getElementById('toggle-sidebar');
            const openFolderBtn = document.getElementById('open-folder');
            const folderList = document.getElementById('folder-list');
            const emptyState = document.getElementById('empty-state');
            const fileExplorer = document.getElementById('file-explorer');
            const fileViewer = document.getElementById('file-viewer');
            const currentPath = document.getElementById('current-path');
            const fileListing = document.getElementById('file-listing');
            const fileContent = document.getElementById('file-content');
            const currentFileName = document.getElementById('current-file-name');
            const runBtn = document.getElementById('run-btn');
            const saveBtn = document.getElementById('save-btn');
            const backButton = document.getElementById('back-button');
            const previewContainer = document.getElementById('preview-container');
            const newFolderBtn = document.getElementById('new-folder-btn');

            // Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
            let currentDirectory = null;
            let directoryHandle = null;
            let fileHandle = null;
            let directoryStructure = {};
            let navigationHistory = [];

            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            toggleSidebarBtn.addEventListener('click', function() {
                sidebar.classList.toggle('sidebar-expanded');
                if (sidebar.classList.contains('sidebar-expanded')) {
                    mainContent.style.marginRight = '250px';
                } else {
                    mainContent.style.marginRight = '0';
                }
            });

            // ÙØªØ­ Ù…Ø¬Ù„Ø¯
            openFolderBtn.addEventListener('click', async function() {
                try {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… Ù…ØªØµÙØ­ Ø§Ù„ÙˆÙŠØ¨ Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„ÙØ§Øª
                    if ('showDirectoryPicker' in window) {
                        directoryHandle = await window.showDirectoryPicker();
                        currentDirectory = directoryHandle;
                        navigationHistory = [directoryHandle];
                        await listDirectoryContents(directoryHandle);
                        emptyState.style.display = 'none';
                        fileExplorer.style.display = 'block';
                        currentPath.textContent = `Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${directoryHandle.name}`;
                        updateSidebar();
                    } else {
                        alert('Ù…ØªØµÙØ­ Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„ÙØ§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø£Ø­Ø¯Ø« Ù…Ø«Ù„ Chrome Ø£Ùˆ Edge.');
                    }
                } catch (error) {
                    console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ÙØªØ­ Ø§Ù„Ù…Ø¬Ù„Ø¯:', error);
                }
            });

            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ù„Ù ÙÙŠ Ø§Ù„ØªØµÙØ­
            backButton.addEventListener('click', function() {
                if (navigationHistory.length > 1) {
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø³Ø§Ø¨Ù‚
                    navigationHistory.pop();
                    currentDirectory = navigationHistory[navigationHistory.length - 1];
                    listDirectoryContents(currentDirectory);
                    currentPath.textContent = `Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${getFullPath(navigationHistory)}`;
                    fileViewer.style.display = 'none';
                }
            });

            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯
            newFolderBtn.addEventListener('click', async function() {
                if (currentDirectory) {
                    const folderName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯:');
                    if (folderName) {
                        try {
                            await currentDirectory.getDirectoryHandle(folderName, { create: true });
                            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
                            listDirectoryContents(currentDirectory);
                        } catch (error) {
                            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯:', error);
                            alert('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯: ' + error.message);
                        }
                    }
                }
            });

            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
            saveBtn.addEventListener('click', async function() {
                if (fileHandle) {
                    try {
                        const writable = await fileHandle.createWritable();
                        await writable.write(fileContent.value);
                        await writable.close();
                        alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!');
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù:', error);
                        alert('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù: ' + error.message);
                    }
                }
            });

            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            runBtn.addEventListener('click', function() {
                if (fileHandle) {
                    const fileName = fileHandle.name.toLowerCase();
                    if (fileName.endsWith('.html')) {
                        previewContainer.style.display = 'block';
                        previewContainer.innerHTML = fileContent.value;
                    } else if (fileName.endsWith('.js')) {
                        try {
                            const scriptResult = eval(fileContent.value);
                            previewContainer.style.display = 'block';
                            previewContainer.innerHTML = `<h4>Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ†ÙÙŠØ°:</h4><pre>${scriptResult}</pre>`;
                        } catch (error) {
                            previewContainer.style.display = 'block';
                            previewContainer.innerHTML = `<h4>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°:</h4><pre style="color: red;">${error}</pre>`;
                        }
                    } else if (fileName.endsWith('.css')) {
                        previewContainer.style.display = 'block';
                        previewContainer.innerHTML = `
                            <h4>Ù…Ø¹Ø§ÙŠÙ†Ø© CSS:</h4>
                            <style>${fileContent.value}</style>
                            <div id="css-preview" style="border: 1px dashed #ddd; padding: 15px; margin-top: 10px;">
                                <h3>Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Ù…Ø· CSS</h3>
                                <p>Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.</p>
                                <button>Ø²Ø± Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
                            </div>
                        `;
                    }
                }
            });

            // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯
            async function listDirectoryContents(directoryHandle) {
                fileListing.innerHTML = '';
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
                for await (const entry of directoryHandle.values()) {
                    const item = document.createElement('div');
                    item.className = entry.kind === 'directory' ? 'folder-item' : 'file-item';
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
                    const icon = document.createElement('span');
                    icon.className = 'icon';
                    if (entry.kind === 'directory') {
                        icon.textContent = 'ğŸ“';
                    } else {
                        const fileName = entry.name.toLowerCase();
                        if (fileName.endsWith('.html')) {
                            icon.textContent = 'ğŸŒ';
                        } else if (fileName.endsWith('.js')) {
                            icon.textContent = 'ğŸ“œ';
                        } else if (fileName.endsWith('.css')) {
                            icon.textContent = 'ğŸ¨';
                        } else {
                            icon.textContent = 'ğŸ“„';
                        }
                    }
                    
                    item.appendChild(icon);
                    
                    const name = document.createElement('span');
                    name.textContent = entry.name;
                    item.appendChild(name);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø±
                    item.addEventListener('click', async function() {
                        if (entry.kind === 'directory') {
                            currentDirectory = entry;
                            navigationHistory.push(entry);
                            await listDirectoryContents(entry);
                            currentPath.textContent = `Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${getFullPath(navigationHistory)}`;
                            fileViewer.style.display = 'none';
                        } else {
                            // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù
                            try {
                                fileHandle = entry;
                                const file = await entry.getFile();
                                const contents = await file.text();
                                fileContent.value = contents;
                                currentFileName.textContent = entry.name;
                                fileViewer.style.display = 'block';
                                previewContainer.style.display = 'none';
                                
                                // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙ‚Ø·
                                const fileName = entry.name.toLowerCase();
                                if (fileName.endsWith('.html') || fileName.endsWith('.js') || fileName.endsWith('.css')) {
                                    runBtn.style.display = 'inline-block';
                                } else {
                                    runBtn.style.display = 'none';
                                }
                            } catch (error) {
                                console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù:', error);
                            }
                        }
                    });
                    
                    fileListing.appendChild(item);
                }
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
            async function updateSidebar() {
                folderList.innerHTML = '';
                
                if (directoryHandle) {
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                    const rootItem = document.createElement('div');
                    rootItem.className = 'folder-item';
                    rootItem.innerHTML = `<span class="icon">ğŸ“</span> ${directoryHandle.name} (Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)`;
                    rootItem.addEventListener('click', function() {
                        currentDirectory = directoryHandle;
                        navigationHistory = [directoryHandle];
                        listDirectoryContents(directoryHandle);
                        currentPath.textContent = `Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${directoryHandle.name}`;
                        fileViewer.style.display = 'none';
                    });
                    folderList.appendChild(rootItem);
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
                    try {
                        for await (const entry of directoryHandle.values()) {
                            if (entry.kind === 'directory') {
                                const item = document.createElement('div');
                                item.className = 'folder-item';
                                item.innerHTML = `<span class="icon">ğŸ“</span> ${entry.name}`;
                                item.addEventListener('click', function() {
                                    currentDirectory = entry;
                                    navigationHistory = [directoryHandle, entry];
                                    listDirectoryContents(entry);
                                    currentPath.textContent = `Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${directoryHandle.name}/${entry.name}`;
                                    fileViewer.style.display = 'none';
                                });
                                folderList.appendChild(item);
                            }
                        }
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ:', error);
                    }
                }
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„
            function getFullPath(history) {
                return history.map(handle => handle.name).join('/');
            }
        });
    </script>
</body>
</html>
